<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0">
    <reference id="jpaTemplate" interface="org.apache.aries.jpa.template.JpaTemplate" filter="(osgi.unit.name=PU)"/>
    <reference id="datasource" interface="javax.sql.DataSource"
               filter="(osgi.jndi.service.name=jdbc/ru.training.model.model-datasource)"/>
    <bean id="repo" class="ru.training.karaf.repo.Repo">
        <argument ref="jpaTemplate"/>
    </bean>
    <bean id="userRepo" class="ru.training.karaf.repo.UserRepo">
        <argument ref="jpaTemplate"/>
    </bean>
    <bean id="locationRepo" class="ru.training.karaf.repo.LocationRepo">
        <argument ref="jpaTemplate"/>
        <argument ref="datasource"/>
    </bean>
    <bean id="unitRepo" class="ru.training.karaf.repo.UnitRepo">
        <argument ref="jpaTemplate"/>
    </bean>
    <bean id="paramRepo" class="ru.training.karaf.repo.ClimateParameterRepo">
            <argument ref="jpaTemplate"/>
    </bean>
    <bean id="typeRepo" class="ru.training.karaf.repo.SensorTypeRepo">
        <argument ref="jpaTemplate"/>
    </bean>
    <bean id="sensorRepo" class="ru.training.karaf.repo.SensorRepo">
        <argument ref="jpaTemplate"/>
    </bean>
    <bean id="measuringRepo" class="ru.training.karaf.repo.MeasuringRepo">
            <argument ref="jpaTemplate"/>
    </bean>
    <bean id="roleRepo" class="ru.training.karaf.repo.RoleRepo" init-method="init">
            <argument ref="jpaTemplate"/>
    </bean>
    <bean id="sensorView" class="ru.training.karaf.view.SensorViewImpl">
        <argument ref="sensorRepo"/>
    </bean>
    <bean id="userView" class="ru.training.karaf.view.UserViewImpl">
        <argument ref="userRepo"/>
    </bean>
    <bean id="locationView" class="ru.training.karaf.view.LocationViewImpl">
        <argument ref="locationRepo"/>
    </bean>
    <bean id="unitView" class="ru.training.karaf.view.UnitViewImpl">
        <argument ref="unitRepo"/>
    </bean>
    <bean id="paramView" class="ru.training.karaf.view.ClimateParameterViewImpl">
        <argument ref="paramRepo"/>
    </bean>
    <bean id="typeView" class="ru.training.karaf.view.SensorTypeViewImpl">
        <argument ref="typeRepo"/>
    </bean>
    <bean id="measuringView" class="ru.training.karaf.view.MeasuringViewImpl">
        <argument ref="measuringRepo"/>
    </bean>
    <bean id="roleView" class="ru.training.karaf.view.RoleViewImpl">
        <argument ref="roleRepo"/>
    </bean>
    <bean id="viewFacade" class = "ru.training.karaf.view.ViewFacadeImpl">
        <property name="views">
            <reference-list interface="ru.training.karaf.view.ViewType"
                            availability="optional"/>
        </property>
    </bean>
    <service ref="viewFacade" interface="ru.training.karaf.view.ViewFacade"/>
    <service ref="userView" interface="ru.training.karaf.view.ViewType"/>
    <service ref="locationView" interface="ru.training.karaf.view.ViewType"/>
    <service ref="unitView" interface="ru.training.karaf.view.ViewType"/>
    <service ref="paramView" interface="ru.training.karaf.view.ViewType"/>
    <service ref="typeView" interface="ru.training.karaf.view.ViewType"/>
    <service ref="sensorView" interface="ru.training.karaf.view.ViewType"/>
    <service ref="measuringView" interface="ru.training.karaf.view.ViewType"/>
    <service ref="roleView" interface="ru.training.karaf.view.ViewType"/>
</blueprint>
